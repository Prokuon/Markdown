# 机器视觉检测

## 一、系统

1. 硬件设备

   * 相机 + 镜头 （工控电脑，智能相机）
   * 光源
2. 软件

   * 操作系统 $\rightarrow$ 数据获取 $\rightarrow$ 视觉检测数据处理（算法） $\rightarrow$ $\boxed{输出}$ 
   * 算法 $\rightarrow$ Python
3. 硬件选则

   * 相机：曝光方式 $\begin{cases} 卷帘\quad 相对静止\\面  \end{cases}$ 

     * 分辨率：10cm范围，0.1mm精度，大于1k水平/垂直分辨率
     * 感光芯片：$\begin{cases} CMOS \\ CCD \end{cases}$ 尺寸大小
     * 帧率：$\begin{cases} 曝光时间 \\ 快门速度 (10Hz) \end{cases}$ 
   * 镜头
     * 视野（FOV）
     * 最大/最小工作距离
     * 景深
     * 成像面
     * 光圈与F值
     * 焦距
     * 分辨率
   
   * 成像几何与摄像机标定
     * 一般成像系统通常将三维场景变换成二位灰度或者彩色图像
     * 可以用一个从三维空间到二维空间的映射表示
4. 标定问题$\begin{cases}绝对定位\\相对定位\\外部定位\\内部定位\\双目立体视差\quad(确定点在场景中的实际位置)\end{cases}$ 
5. 光源选择

   * 颜色：$\begin{cases} 白\\ 红\\ 蓝\\黄\\绿\end{cases}$ 
     * 与检测目标一致，考虑反光
     * 绿色传输带（绿色目标），蓝色物体
   * 规避  $\begin{cases}避免阴影\\避免过亮\\避免光线变化\\避免外界影响\end{cases}$
6. 工控机选则

   * USB 3.0
   * 网络接口
   * cameraLink

## 二、数据

1. 图像   $\begin{cases}幅度特征\\直方图特征\\变换系数特征\\点和线条特征\\灰度边沿特征\\纹理特征\end{cases}$ 

1. 预处理

   * 去噪，平滑 $\rightarrow$ 卷积
     * 去噪$\begin{cases} 高斯滤波\quad(高斯卷积核) \quad \boxed{图像平滑处理}\\ 中值滤波\quad \boxed{图像平滑处理}\quad 局部处理，对脉冲干扰级椒盐噪声的抑制效果较好\\ 均值滤波\\ 多幅平均\end{cases}$ 
     * 高通滤波  $\boxed{图像锐化处理}$
     * 维纳滤波器 还原图像
   * 灰度均衡，灰度拉伸
     * 灰度拉伸 $\to$ 改善图像曝光不足
   * 畸变矫正
     * 标定，内参 + 畸变参数
     * $\begin{cases} 切向 \\径向 \end{cases}$ 
   * 图像锐化：空间域，频率域
     * 方法$\begin{cases} 直接以梯度值代替\\ 辅以门限判断\\ 给边缘规定一个特定的灰度级\\ 给背景规定灰度级\\ 根据梯度二值化图像\end{cases}$ 

2. 特征提取

   * 区域，二值化 $\rightarrow$ 形态学处理 $\rightarrow$ 轮廓区域 $\begin{cases} 面积 \\周长 \\中心 \\中矩特征 \end{cases}$ 

     * 二值化$\begin{cases} 固定阈值\quad\boxed{直方图确定阈值}\\自适应阈值\begin{cases}大津法\\分水岭\end{cases}\end{cases}$ 
       * 灰度图转化成二值图像：im2bw
       * 二值分割  $g\,(i,j) = \begin{cases}255\quad if \quad f(i,j) \geq T\\0\quad\quad if \quad f(i,j) < T\end{cases}$ 
       * 半阈值分割  $g\,(i,j) = \begin{cases}f(i,j)\quad if \quad f(i,j) \geq T\\0\quad\quad\quad if \quad f(i,j) < T\end{cases}$ 
       * 多阈值分割  $f'(i,j) = \begin{cases}1\quad if \quad T_1 \leq f(i,j) \leq T_2\\0\quad  others\end{cases}$ 
   
     * 区域标记$\begin{cases}轮廓\rightarrow 外接矩形\,周长，面积\\区域标记\rightarrow 种子填充(集合)\end{cases}$
     * 形态学处理（开闭运算，核选择）
       * 腐蚀
       * 膨胀（连通距离较近物体，填补物体空洞）
       * 开运算（去除孤立的噪点）
       * 闭运算（弥补目标物体中细小缺损）
   
   * 边缘：Sobel ，Canny，链码 $\rightarrow$ 霍夫变换（提取直线）

     * Sobel：梯度
     * 霍夫变换：提取直线 $\begin{cases}不受图形旋转的影响\\广义霍夫变换\quad检测任意形状曲线\\优点\quad受噪声和曲线间断影响较小\end{cases}$​
     * 抗噪性最好的算法：Prewitt滤波器
   
   * 轮廓提取
   
     * 掏空内部点：若一点为白色，八个相邻点均为白色，记为内部点，删除；否则为边界点，保留
   
   * 纹理 
   
     * 灰度共生矩阵 Gobar
     * 灰度共生矩阵
     * 纹理分析法$\begin{cases} 统计分析法\\结构分析法\end{cases}$ 
     * 描述图像中反复出现的局部模式和它们的排布规律
     * 灰度级为常数，则视为没有纹理
     * 局部不规则，而宏观有规律性
     * 主要问题  $\begin{cases}纹理分类\\纹理分割\\纹理恢复\end{cases}$ 
       * 纹理分割：图像滤波，边缘提取；利用滤波器提取纹理结构
       * 纹理分析：$\begin{cases}纹理分析法\\尺寸选择法\\结构分析法\end{cases}$ 
         * 能量      反应纹理一致性
         * 熵      反应纹理复杂度
         * 矩      反应纹理清晰度
         * 局部平稳性      反应图像纹理高低频比例
         * 相关性度量      反应数据波动程度
   
   * 光流
   
     * 关于视域中物体运动检测的概念
     * 描述相对于观察者的运动造成的观测目标，表面或边缘的运动
   
   * 颜色：颜色空间  $\begin{cases}RGB\quad(计算机显示器)\quad(红，绿，蓝)\\HSV\quad(色相，饱和度，亮度)\end{cases}$ 
   
     * 彩色图像$\begin{cases}\left.\begin{matrix}色调\\饱和度\end{matrix}\right\}\,\,色度 \rightarrow 表示颜色的类别与深浅程度\\\,\,\,亮度\end{cases}$
     * HSI模型
       * 亮度和色度分量分开
       * 色调与饱和度的概念与人的感知密切联系
     * HSV颜色空间
       * Hue：色调，圆锥体角度
       * Saturation：饱和度，与椎体中心的距离
       * Value：明度，椎体高度
     * YCbCr
       * Y：色彩亮度
       * Cb：蓝色浓度偏移成分
       * Cr：红色浓度偏移成分
       * 特点：计算较快，易于压缩，常用于电视信号
   
   * 主体视觉，几何特征：$\begin{cases}内参\\外参\\畸变\\单位矩阵\\基础矩阵 \end{cases}$ 
   
     极线约束 本征矩阵 图像匹配
   
     模板匹配 相关系数 像素 几何
   
     * 本征矩阵：包含了物理空间中两个摄像机相关的旋转 (R) 和平移信息 (T)
     * 基础矩阵：除了包含本征矩阵的信息外，还包含了两个摄像机的内参数
   
   * 判别（机器学习，深度学习）
   
   * 模板匹配
   
     * 定位功能 $\begin{cases}像素，相关系数\\几何匹配(适用于旋转) \\局部特征\boxed{主体匹配}\quad ORDSLAM\quad SIFT\quad SURF\end{cases}$ 
   
   * 直方图修正法$\begin{cases} 直方图均衡\\直方图规定化（匹配）：用于产生处理后有特殊直方图的图像的方法\end{cases}$ 

## 三、概念

1. 8-连通定义：对于具有值V的像素 p 和 q ，如果 q 在集合N8(p)中，则称这两个像素是8-连通的

2. 像素的邻域：邻域是指一个像元 (x, y) 附近形成的像元集合。即 {(x = p, y = q)} p, q 为任意整数。

   像素的四邻域分别为：$\begin{matrix}&(x, y + 1) & &\\ (x - 1, y) & & (x + 1, y)\\ & (x, y - 1)\end{matrix}$ 

3. $\left. \begin{matrix}伪彩色增强：1 \rightarrow 3  \rightarrow 1\\ 假彩色增强：3 \rightarrow 3 \end{matrix} \right\} $ 差异：处理对象不同，相同点：利用人眼对彩色的分辨能力高于灰度分辨能力的特点

4. 数字图像的冗余$\begin{cases}空间冗余\\时间冗余\\视觉冗余\\信息熵冗余\\结构冗余\\知识冗余\end{cases}$ 

5. 图像锐化：增强边缘，导致高频分量增加，使图片清晰  $\begin{cases}高通滤波法\\微分法\end{cases}$ 

   图像平滑：用于消除图像噪声，容易引起边缘模糊 $\begin{cases}邻域平均法\\中值滤波\\多图像平均法\\频域低通滤波法\end{cases}$ 

6. 亮度适应级

7. 直方图越均匀，图像对比度越好

8. 梯度算子
   * 利用阶跃边缘灰度变化的一阶导数特性，极大值点对应于边缘点
   * 模板：$\boxed {\,\,-1 \,\,\,|\,\,\,\,1\,\,\, }$  $\boxed { \begin{matrix} -1\\-\\1\end{matrix}}$ 

   Laplacian算子

   * 利用阶跃边缘灰度变化的二阶导数特性，认为边缘点是零交叉点
   * 模板：$\boxed{\begin{matrix} & 1 & \\1&-4&1\\&1&\end{matrix}}$ 

   都能用于边缘检测，且对噪声敏感

9. 椒盐噪声：复制近似相等，但随机分布在不同的位置上

   中值滤波：选择适当的点代替污染的点

   均值滤波：噪声均值不为零，无法去除

10. 区域：图象中具有相互连通，一致属性的像素集合

11. 图像退化模型：$g(x, y) = H[f(x, y)] + n(x, y)$

12. 图像运算 $\left\{\begin{matrix}点运算\\代数运算\\几何运算\end{matrix}\right\}$ 以像素点的幅度值为运算单元；

    * 几何运算  $\begin{cases}空间变换\\灰度插值\end{cases}$     要求保持图像曲线特性和各物体连通性

13. 视觉检测应用  $\begin{cases}工业自动化\\实验图像\\移动机器人导航，人机接口\\字符识别，图样自动识别与录入\\遥感图像分析\\生物医学图像\end{cases}$ 

14. 视觉检测基本过程  $\begin{cases}图像获取\\图像预处理\\特征提取\\特征识别\\输出识别结果\end{cases}$ 

15. 数字图像化：将连续的模拟信号转化为离散数字图像信号；

    过程：采样和量化；

    量化：将采集的模拟信号转化为数字系统可识别的数字量

16. 数字图像的数据结构  $\begin{cases}矩阵的行对应图像的高\\矩阵的列对应图像的宽\\矩阵的元素对应图像的像素\\矩阵图像的值就是像素的灰度值\\\end{cases}$ 

17. 清晰度  $\begin{cases}亮度\\对比度\\尺寸大小\\细微层次\\颜色饱和度\\\end{cases}$ 

18. 像素间基本关系  $\begin{cases}相邻像素\begin{cases}4邻域\\D邻域\\8邻域\end{cases}\\\,\,\,连通性\,\,\left\{\begin{matrix}4连通\\8连通\\m连通\end{matrix}\right\} 必要条件 \begin{cases}两像素位置是否相邻\\灰度值是否满足特定相似性原则\end{cases}\end{cases}$ 

## 四、综合

1. 提取鼠标
   * 读图
   * 转为灰度图
   * 高斯模糊
   * 选择合适阈值，将图片二值化
2. 零件抓取
   * 硬件要求
     * 传输带颜色为黑
     * 白色条形光源
     * 深度相机
     * 彩色摄像头，线阵$CCD$相机
     * 1394系列图像采集卡
     * $PentiumIII$ 或更高$CPU$
   * 软件要求主要包括点云处理模块和相机与机械臂之间的通信模块

